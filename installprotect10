#!/bin/bash

echo "ðŸŽ¨ Updating iOS Dark Theme with Premium Admin & Console Design..."

PANEL_PATH="/var/www/pterodactyl"
BASE_TEMPLATE="$PANEL_PATH/resources/views/templates/base/core.blade.php"
AUTH_LAYOUT="$PANEL_PATH/resources/views/layouts/auth.blade.php"
APP_LAYOUT="$PANEL_PATH/resources/views/layouts/app.blade.php"
ADMIN_LAYOUT="$PANEL_PATH/resources/views/layouts/admin.blade.php"
TIMESTAMP=$(date -u +"%Y-%m-%d-%H-%M-%S")

# Background Image URL
BG_IMAGE="https://files.catbox.moe/z32ox4.jpg"

# ===== BACKUP =====
cp "$BASE_TEMPLATE" "${BASE_TEMPLATE}.bak_${TIMESTAMP}"
cp "$AUTH_LAYOUT" "${AUTH_LAYOUT}.bak_${TIMESTAMP}"
cp "$APP_LAYOUT" "${APP_LAYOUT}.bak_${TIMESTAMP}"
cp "$ADMIN_LAYOUT" "${ADMIN_LAYOUT}.bak_${TIMESTAMP}"
echo "ðŸ“¦ Backup semua file OK"

# ===== 1. UPDATE BASE TEMPLATE (PREMIUM iOS THEME) =====
cat > "$BASE_TEMPLATE" << 'EOF'
@extends('templates/wrapper', [
    'css' => ['body' => 'bg-neutral-800'],
])

@section('container')
    <div id="modal-portal"></div>
    <div id="app"></div>

    <!-- Premium iOS Theme CSS -->
    <style>
    /* ===== PREMIUM iOS DARK THEME - RENSTR EDITION ===== */
    :root {
      --ios-bg: #000000;
      --ios-card: rgba(28, 28, 30, 0.85);
      --ios-card-secondary: rgba(44, 44, 46, 0.9);
      --ios-surface: rgba(58, 58, 60, 0.8);
      --ios-blue: #0a84ff;
      --ios-blue-light: #5ac8fa;
      --ios-green: #30d158;
      --ios-red: #ff375f;
      --ios-purple: #bf5af2;
      --ios-orange: #ff9f0a;
      --ios-cyan: #64d2ff;
      --ios-pink: #ff2d55;
      --ios-text-primary: #ffffff;
      --ios-text-secondary: #8e8e93;
      --ios-text-tertiary: #636366;
      --ios-border: rgba(56, 56, 58, 0.6);
      --ios-blur: rgba(28, 28, 30, 0.75);
      --ios-shadow: 0 10px 40px rgba(0,0,0,0.35);
      --ios-glow: 0 0 40px rgba(10, 132, 255, 0.15);
      --ios-glow-green: 0 0 40px rgba(48, 209, 88, 0.15);
      --ios-glow-purple: 0 0 40px rgba(191, 90, 242, 0.15);
    }

    /* PREMIUM Background with Dynamic Gradient */
    body:not(.in-file-manager) {
      background: 
        radial-gradient(ellipse at 20% 20%, rgba(10, 132, 255, 0.1) 0%, transparent 60%),
        radial-gradient(ellipse at 80% 80%, rgba(191, 90, 242, 0.1) 0%, transparent 60%),
        radial-gradient(ellipse at 40% 60%, rgba(255, 55, 95, 0.05) 0%, transparent 60%),
        linear-gradient(135deg, rgba(0,0,0,0.95) 0%, rgba(20,20,30,0.9) 100%),
        url('https://files.catbox.moe/z32ox4.jpg') !important;
      background-size: cover, cover, cover, cover, cover !important;
      background-position: center !important;
      background-attachment: fixed !important;
      background-blend-mode: overlay, overlay, overlay, normal, overlay !important;
      color: var(--ios-text-primary) !important;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", "Segoe UI", Roboto, "Inter", sans-serif !important;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    /* Animated Gradient Overlay */
    body:not(.in-file-manager)::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 20% 20%, rgba(10, 132, 255, 0.15) 0%, transparent 40%),
        radial-gradient(circle at 80% 20%, rgba(191, 90, 242, 0.15) 0%, transparent 40%),
        radial-gradient(circle at 40% 80%, rgba(48, 209, 88, 0.1) 0%, transparent 40%);
      pointer-events: none;
      z-index: -1;
      animation: gradientShift 20s ease infinite;
    }

    @keyframes gradientShift {
      0%, 100% { 
        background: 
          radial-gradient(circle at 20% 20%, rgba(10, 132, 255, 0.15) 0%, transparent 40%),
          radial-gradient(circle at 80% 20%, rgba(191, 90, 242, 0.15) 0%, transparent 40%),
          radial-gradient(circle at 40% 80%, rgba(48, 209, 88, 0.1) 0%, transparent 40%);
      }
      33% { 
        background: 
          radial-gradient(circle at 80% 20%, rgba(10, 132, 255, 0.15) 0%, transparent 40%),
          radial-gradient(circle at 40% 80%, rgba(191, 90, 242, 0.15) 0%, transparent 40%),
          radial-gradient(circle at 20% 20%, rgba(48, 209, 88, 0.1) 0%, transparent 40%);
      }
      66% { 
        background: 
          radial-gradient(circle at 40% 80%, rgba(10, 132, 255, 0.15) 0%, transparent 40%),
          radial-gradient(circle at 20% 20%, rgba(191, 90, 242, 0.15) 0%, transparent 40%),
          radial-gradient(circle at 80% 20%, rgba(48, 209, 88, 0.1) 0%, transparent 40%);
      }
    }

    /* === PREMIUM CONSOLE STYLING === */
    /* Console Container - Terminal Style */
    .console-container,
    .terminal,
    [class*="console"],
    [class*="terminal"],
    .bg-gray-700:has(textarea),
    textarea.bg-gray-700 {
      background: rgba(10, 10, 12, 0.95) !important;
      backdrop-filter: blur(20px) !important;
      border: 1px solid rgba(10, 132, 255, 0.3) !important;
      border-radius: 16px !important;
      box-shadow: 
        0 10px 40px rgba(0,0,0,0.5),
        inset 0 1px 0 rgba(255,255,255,0.1),
        0 0 0 1px rgba(10, 132, 255, 0.1) !important;
      font-family: 'SF Mono', 'Cascadia Code', 'Monaco', monospace !important;
      font-size: 14px !important;
      color: #0afc6e !important;
      text-shadow: 0 0 10px rgba(10, 252, 110, 0.5) !important;
    }

    /* Console Textarea */
    textarea.bg-gray-700,
    .console-container textarea {
      background: transparent !important;
      border: none !important;
      color: #0afc6e !important;
      caret-color: #0a84ff !important;
      padding: 20px !important;
      line-height: 1.6 !important;
      font-size: 14px !important;
      resize: none !important;
    }

    /* Console Input */
    .console-input {
      background: rgba(20, 20, 25, 0.9) !important;
      border: 1px solid rgba(10, 132, 255, 0.4) !important;
      border-radius: 12px !important;
      color: #ffffff !important;
      padding: 14px 18px !important;
      font-family: 'SF Mono', monospace !important;
      font-size: 14px !important;
    }

    /* Console Stats Cards */
    .server-stats-card,
    .stats-card,
    .bg-gray-800.rounded {
      background: linear-gradient(145deg, rgba(28, 28, 30, 0.9), rgba(20, 20, 25, 0.9)) !important;
      backdrop-filter: blur(30px) !important;
      border: 1px solid rgba(10, 132, 255, 0.2) !important;
      border-radius: 20px !important;
      padding: 24px !important;
      margin: 16px !important;
      box-shadow: 
        0 15px 35px rgba(0,0,0,0.4),
        0 0 60px rgba(10, 132, 255, 0.1) !important;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    .server-stats-card:hover {
      transform: translateY(-5px) !important;
      border-color: rgba(10, 132, 255, 0.5) !important;
      box-shadow: 
        0 20px 50px rgba(0,0,0,0.5),
        0 0 80px rgba(10, 132, 255, 0.2) !important;
    }

    /* Stats Grid Layout */
    .grid.grid-cols-1.md\:grid-cols-2.lg\:grid-cols-4.gap-6 {
      display: grid !important;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)) !important;
      gap: 24px !important;
      padding: 20px !important;
    }

    /* Individual Stat Box */
    .stat-box {
      background: linear-gradient(135deg, rgba(28, 28, 30, 0.85), rgba(44, 44, 46, 0.9)) !important;
      backdrop-filter: blur(25px) !important;
      border: 1px solid var(--ios-border) !important;
      border-radius: 18px !important;
      padding: 20px !important;
      position: relative;
      overflow: hidden;
    }

    .stat-box::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--ios-blue), var(--ios-purple)) !important;
    }

    .stat-box.cpu::before { background: linear-gradient(90deg, var(--ios-blue), #5ac8fa) !important; }
    .stat-box.memory::before { background: linear-gradient(90deg, var(--ios-green), #30d158) !important; }
    .stat-box.disk::before { background: linear-gradient(90deg, var(--ios-orange), #ff9f0a) !important; }
    .stat-box.network::before { background: linear-gradient(90deg, var(--ios-purple), #bf5af2) !important; }

    /* Stat Labels */
    .stat-label {
      color: var(--ios-text-secondary) !important;
      font-size: 13px !important;
      font-weight: 500 !important;
      text-transform: uppercase !important;
      letter-spacing: 0.5px !important;
      margin-bottom: 8px !important;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .stat-label i {
      font-size: 16px !important;
      opacity: 0.8;
    }

    /* Stat Values */
    .stat-value {
      font-size: 28px !important;
      font-weight: 800 !important;
      background: linear-gradient(90deg, var(--ios-text-primary), var(--ios-text-secondary)) !important;
      -webkit-background-clip: text !important;
      -webkit-text-fill-color: transparent !important;
      background-clip: text !important;
      margin: 8px 0 !important;
      line-height: 1.2 !important;
    }

    /* Stat Progress Bars */
    .stat-progress {
      height: 8px !important;
      background: rgba(255,255,255,0.1) !important;
      border-radius: 4px !important;
      overflow: hidden !important;
      margin-top: 12px !important;
    }

    .stat-progress-bar {
      height: 100% !important;
      border-radius: 4px !important;
      background: linear-gradient(90deg, var(--ios-blue), var(--ios-purple)) !important;
      position: relative;
      overflow: hidden;
    }

    .stat-progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent) !important;
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* === PREMIUM ADMIN PANEL STYLING === */
    /* Admin Sidebar */
    .admin-sidebar,
    nav.bg-gray-800,
    aside.bg-gray-800 {
      background: linear-gradient(180deg, rgba(10, 10, 15, 0.95), rgba(20, 20, 30, 0.9)) !important;
      backdrop-filter: blur(40px) saturate(200%) !important;
      border-right: 1px solid rgba(10, 132, 255, 0.2) !important;
      box-shadow: 
        5px 0 30px rgba(0,0,0,0.3),
        inset -1px 0 0 rgba(255,255,255,0.05) !important;
    }

    /* Admin Menu Items */
    .admin-menu-item,
    nav a,
    aside a {
      color: var(--ios-text-secondary) !important;
      padding: 16px 20px !important;
      margin: 4px 12px !important;
      border-radius: 14px !important;
      display: flex !important;
      align-items: center !important;
      gap: 12px !important;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
      position: relative !important;
      overflow: hidden !important;
    }

    .admin-menu-item::before,
    nav a::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(10, 132, 255, 0.1), transparent) !important;
      transition: left 0.6s;
    }

    .admin-menu-item:hover,
    nav a:hover {
      background: rgba(10, 132, 255, 0.1) !important;
      color: var(--ios-text-primary) !important;
      transform: translateX(8px) !important;
      border-left: 3px solid var(--ios-blue) !important;
    }

    .admin-menu-item:hover::before,
    nav a:hover::before {
      left: 100%;
    }

    .admin-menu-item.active {
      background: linear-gradient(90deg, rgba(10, 132, 255, 0.2), rgba(10, 132, 255, 0.1)) !important;
      color: var(--ios-blue) !important;
      border-left: 3px solid var(--ios-blue) !important;
    }

    /* Admin Main Content */
    .admin-content,
    main.bg-gray-100 {
      background: transparent !important;
      padding: 30px !important;
    }

    /* Admin Cards */
    .admin-card,
    .bg-white.rounded {
      background: linear-gradient(145deg, rgba(28, 28, 30, 0.9), rgba(44, 44, 46, 0.9)) !important;
      backdrop-filter: blur(30px) !important;
      border: 1px solid rgba(56, 56, 58, 0.5) !important;
      border-radius: 20px !important;
      padding: 30px !important;
      box-shadow: 
        0 20px 60px rgba(0,0,0,0.4),
        0 0 80px rgba(10, 132, 255, 0.1) !important;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
    }

    .admin-card:hover {
      transform: translateY(-5px) !important;
      border-color: rgba(10, 132, 255, 0.4) !important;
      box-shadow: 
        0 25px 70px rgba(0,0,0,0.5),
        0 0 100px rgba(10, 132, 255, 0.15) !important;
    }

    /* Admin Headers */
    .admin-header,
    h1, h2, h3 {
      background: linear-gradient(90deg, #0a84ff, #5ac8fa, #bf5af2) !important;
      -webkit-background-clip: text !important;
      -webkit-text-fill-color: transparent !important;
      background-size: 200% auto !important;
      animation: gradientText 3s ease infinite !important;
      font-weight: 800 !important;
      letter-spacing: -0.5px !important;
      margin-bottom: 24px !important;
    }

    @keyframes gradientText {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Admin Tables */
    .admin-table {
      background: rgba(28, 28, 30, 0.8) !important;
      backdrop-filter: blur(20px) !important;
      border-radius: 16px !important;
      overflow: hidden !important;
      border: 1px solid rgba(56, 56, 58, 0.5) !important;
    }

    .admin-table th {
      background: linear-gradient(90deg, rgba(10, 132, 255, 0.2), rgba(10, 132, 255, 0.1)) !important;
      color: var(--ios-text-primary) !important;
      font-weight: 600 !important;
      padding: 18px 20px !important;
      border-bottom: 1px solid rgba(10, 132, 255, 0.3) !important;
    }

    .admin-table td {
      padding: 16px 20px !important;
      border-bottom: 1px solid rgba(56, 56, 58, 0.3) !important;
      color: var(--ios-text-secondary) !important;
      transition: all 0.2s ease !important;
    }

    .admin-table tr:hover td {
      background: rgba(10, 132, 255, 0.05) !important;
      color: var(--ios-text-primary) !important;
    }

    /* === FILE MANAGER EXCLUSION === */
    .elfinder * {
      all: revert !important;
    }
    </style>

    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- SF Pro Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css">
    <!-- SF Mono Font for Console -->
    <link href="https://fonts.googleapis.com/css2?family=SF+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Deteksi jika sedang di file manager
        const isInFileManager = () => {
          return document.querySelector('.elfinder') !== null || 
                 window.location.pathname.includes('/file-manager');
        };

        if (isInFileManager()) {
          document.body.classList.add('in-file-manager');
          return;
        }

        const username = @json(auth()->user()->name?? 'User');
        const isAdmin = @json(auth()->user() && auth()->user()->root_admin ?? false);
        
        // Create Premium Welcome Message
        const message = document.createElement("div");
        message.innerHTML = `
          <div style="display: flex; align-items: center; gap: 16px;">
            <div style="
              width: 48px;
              height: 48px;
              background: linear-gradient(135deg, #0a84ff, #bf5af2);
              border-radius: 14px;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 20px;
              color: white;
              box-shadow: 0 8px 32px rgba(10, 132, 255, 0.3);
              animation: iconFloat 3s ease-in-out infinite;
            ">
              <i class="fas fa-${isAdmin ? 'crown' : 'cube'}"></i>
            </div>
            <div>
              <div style="font-weight: 700; font-size: 16px; letter-spacing: 0.2px;">
                Welcome, <strong style="background: linear-gradient(90deg, #0a84ff, #bf5af2); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">${username}</strong>! ${isAdmin ? 'ðŸ‘‘' : 'ðŸ‘‹'}
              </div>
              <div style="font-size: 12px; opacity: 0.8; margin-top: 4px; display: flex; align-items: center; gap: 8px;">
                <span style="display: flex; align-items: center; gap: 4px;">
                  <i class="fas fa-shield-alt" style="color: #30d158;"></i>
                  ${isAdmin ? 'Administrator Access' : 'User Access'}
                </span>
                <span>â€¢</span>
                <span>Â© Rendzz Official</span>
              </div>
            </div>
          </div>
        `;
        
        Object.assign(message.style, {
          position: "fixed",
          bottom: "30px",
          right: "30px",
          background: "rgba(28, 28, 30, 0.95)",
          backdropFilter: "blur(40px) saturate(200%)",
          WebkitBackdropFilter: "blur(40px) saturate(200%)",
          color: "#ffffff",
          padding: "22px 26px",
          borderRadius: "24px",
          fontFamily: "-apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif",
          fontSize: "14px",
          boxShadow: "0 20px 60px rgba(0,0,0,0.5), 0 0 80px rgba(10, 132, 255, 0.15)",
          border: "1px solid rgba(56, 56, 58, 0.6)",
          zIndex: "99999",
          opacity: "0",
          transform: "translateY(100px) scale(0.9)",
          transition: "all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)",
          maxWidth: "380px",
          cursor: "pointer",
        });

        document.body.appendChild(message);
        
        // Animate in
        setTimeout(() => {
          message.style.opacity = "1";
          message.style.transform = "translateY(0) scale(1)";
        }, 500);
        
        // Auto-hide after 8 seconds
        setTimeout(() => {
          message.style.opacity = "0";
          message.style.transform = "translateY(100px) scale(0.9)";
        }, 8000);
        
        setTimeout(() => {
          if (message.parentNode) {
            message.remove();
          }
        }, 9000);

        // Click to dismiss
        message.addEventListener("click", () => {
          message.style.opacity = "0";
          message.style.transform = "translateY(100px) scale(0.9)";
          setTimeout(() => {
            if (message.parentNode) {
              message.remove();
            }
          }, 500);
        });

        // Add Premium Console Enhancements
        const enhanceConsole = () => {
          if (isInFileManager()) return;
          
          // Find console containers
          document.querySelectorAll('.console-container, textarea.bg-gray-700').forEach(consoleEl => {
            if (!consoleEl.closest('.elfinder')) {
              // Add terminal header
              const header = consoleEl.querySelector('.terminal-header');
              if (!header) {
                const newHeader = document.createElement('div');
                newHeader.className = 'terminal-header';
                newHeader.innerHTML = `
                  <div style="
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    padding: 12px 20px;
                    background: rgba(10, 10, 15, 0.9);
                    border-bottom: 1px solid rgba(10, 132, 255, 0.3);
                    border-radius: 16px 16px 0 0;
                  ">
                    <div style="display: flex; align-items: center; gap: 12px;">
                      <div style="display: flex; gap: 8px;">
                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #ff375f;"></div>
                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #ff9f0a;"></div>
                        <div style="width: 12px; height: 12px; border-radius: 50%; background: #30d158;"></div>
                      </div>
                      <span style="color: #8e8e93; font-size: 13px; font-weight: 500;">
                        <i class="fas fa-terminal"></i> RENSTR Console
                      </span>
                    </div>
                    <div style="color: #0afc6e; font-family: 'SF Mono'; font-size: 12px;">
                      <i class="fas fa-bolt"></i> LIVE
                    </div>
                  </div>
                `;
                consoleEl.insertBefore(newHeader, consoleEl.firstChild);
              }
            }
          });

          // Enhance stats cards
          document.querySelectorAll('.bg-gray-800.rounded, .server-stats-card').forEach(card => {
            if (!card.closest('.elfinder')) {
              card.classList.add('server-stats-card');
              
              // Add icons based on content
              const text = card.textContent.toLowerCase();
              if (text.includes('cpu') || text.includes('load')) {
                card.classList.add('cpu');
                const icon = document.createElement('i');
                icon.className = 'fas fa-microchip';
                icon.style.marginRight = '8px';
                card.querySelector('div')?.prepend(icon);
              } else if (text.includes('memory') || text.includes('ram')) {
                card.classList.add('memory');
                const icon = document.createElement('i');
                icon.className = 'fas fa-memory';
                icon.style.marginRight = '8px';
                card.querySelector('div')?.prepend(icon);
              } else if (text.includes('disk') || text.includes('storage')) {
                card.classList.add('disk');
                const icon = document.createElement('i');
                icon.className = 'fas fa-hdd';
                icon.style.marginRight = '8px';
                card.querySelector('div')?.prepend(icon);
              } else if (text.includes('network')) {
                card.classList.add('network');
                const icon = document.createElement('i');
                icon.className = 'fas fa-wifi';
                icon.style.marginRight = '8px';
                card.querySelector('div')?.prepend(icon);
              }
            }
          });
        };

        // Enhance Admin Panel
        const enhanceAdminPanel = () => {
          if (!isAdmin || isInFileManager()) return;
          
          // Add admin badge to header
          const header = document.querySelector('header');
          if (header && !header.querySelector('.admin-badge')) {
            const badge = document.createElement('div');
            badge.className = 'admin-badge';
            badge.innerHTML = `
              <div style="
                display: flex;
                align-items: center;
                gap: 8px;
                background: linear-gradient(90deg, rgba(10, 132, 255, 0.2), rgba(191, 90, 242, 0.2));
                padding: 8px 16px;
                border-radius: 12px;
                border: 1px solid rgba(10, 132, 255, 0.3);
              ">
                <i class="fas fa-crown" style="color: #ff9f0a;"></i>
                <span style="font-size: 13px; font-weight: 600;">Administrator Mode</span>
              </div>
            `;
            header.appendChild(badge);
          }

          // Add admin stats
          const mainContent = document.querySelector('main');
          if (mainContent && window.location.pathname.includes('/admin')) {
            const stats = document.createElement('div');
            stats.className = 'admin-stats';
            stats.innerHTML = `
              <div style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 16px;
                margin-bottom: 24px;
              ">
                <div class="stat-box">
                  <div class="stat-label"><i class="fas fa-server"></i> Total Servers</div>
                  <div class="stat-value">${document.querySelectorAll('[href*="/server/"]').length}</div>
                  <div class="stat-progress"><div class="stat-progress-bar" style="width: 75%"></div></div>
                </div>
                <div class="stat-box">
                  <div class="stat-label"><i class="fas fa-users"></i> Active Users</div>
                  <div class="stat-value">${document.querySelectorAll('[href*="/user/"]').length}</div>
                  <div class="stat-progress"><div class="stat-progress-bar" style="width: 60%"></div></div>
                </div>
              </div>
            `;
            mainContent.insertBefore(stats, mainContent.firstChild);
          }
        };

        // Run enhancements
        setTimeout(() => {
          enhanceConsole();
          enhanceAdminPanel();
        }, 1500);

        // Auto refresh console stats
        if (window.location.pathname.includes('/server/')) {
          setInterval(() => {
            enhanceConsole();
          }, 5000);
        }
      });
    </script>
@endsection
EOF

echo "âœ… Base template updated with Premium iOS theme"

# ===== 2. UPDATE ADMIN LAYOUT SPECIFICALLY =====
ADMIN_ENHANCEMENTS="<style>
/* Premium Admin Enhancements */
.admin-dashboard {
  background: transparent !important;
  padding: 2rem !important;
}

/* Admin Stats Grid */
.admin-stats-grid {
  display: grid !important;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)) !important;
  gap: 24px !important;
  margin-bottom: 2rem !important;
}

/* Admin Control Cards */
.admin-control-card {
  background: linear-gradient(145deg, rgba(28, 28, 30, 0.9), rgba(44, 44, 46, 0.9)) !important;
  backdrop-filter: blur(30px) !important;
  border: 1px solid rgba(10, 132, 255, 0.2) !important;
  border-radius: 20px !important;
  padding: 2rem !important;
  margin-bottom: 1.5rem !important;
  transition: all 0.3s ease !important;
}

.admin-control-card:hover {
  transform: translateY(-5px) !important;
  border-color: rgba(10, 132, 255, 0.4) !important;
  box-shadow: 0 20px 50px rgba(0,0,0,0.4) !important;
}

/* Admin Navigation Enhancements */
.admin-nav-section {
  margin-bottom: 2rem !important;
}

.admin-nav-title {
  color: var(--ios-text-secondary) !important;
  font-size: 12px !important;
  text-transform: uppercase !important;
  letter-spacing: 1px !important;
  margin-bottom: 1rem !important;
  padding-left: 1rem !important;
}

/* Admin Quick Actions */
.admin-quick-actions {
  display: flex !important;
  gap: 12px !important;
  flex-wrap: wrap !important;
  margin-top: 1.5rem !important;
}

.admin-quick-action {
  background: rgba(10, 132, 255, 0.1) !important;
  border: 1px solid rgba(10, 132, 255, 0.3) !important;
  border-radius: 12px !important;
  padding: 12px 20px !important;
  color: var(--ios-text-primary) !important;
  text-decoration: none !important;
  display: flex !important;
  align-items: center !important;
  gap: 10px !important;
  transition: all 0.3s ease !important;
}

.admin-quick-action:hover {
  background: rgba(10, 132, 255, 0.2) !important;
  transform: translateY(-2px) !important;
}

/* Admin Status Indicators */
.admin-status {
  display: inline-flex !important;
  align-items: center !important;
  gap: 6px !important;
  padding: 4px 12px !important;
  border-radius: 20px !important;
  font-size: 12px !important;
  font-weight: 600 !important;
}

.admin-status.online {
  background: rgba(48, 209, 88, 0.2) !important;
  color: var(--ios-green) !important;
  border: 1px solid rgba(48, 209, 88, 0.3) !important;
}

.admin-status.offline {
  background: rgba(255, 55, 95, 0.2) !important;
  color: var(--ios-red) !important;
  border: 1px solid rgba(255, 55, 95, 0.3) !important;
}

.admin-status.warning {
  background: rgba(255, 159, 10, 0.2) !important;
  color: var(--ios-orange) !important;
  border: 1px solid rgba(255, 159, 10, 0.3) !important;
}
</style>

<script>
// Admin Panel Auto Refresh
if (window.location.pathname.includes('/admin')) {
  // Auto refresh stats every 10 seconds
  setInterval(() => {
    const statsElements = document.querySelectorAll('.stat-value');
    statsElements.forEach(el => {
      el.style.opacity = '0.7';
      setTimeout(() => {
        el.style.opacity = '1';
      }, 300);
    });
  }, 10000);
  
  // Add admin panel shortcuts
  document.addEventListener('keydown', (e) => {
    if (e.ctrlKey && e.key === 'd') {
      // Ctrl+D for dashboard
      window.location.href = '/admin';
    }
    if (e.ctrlKey && e.key === 's') {
      // Ctrl+S for servers
      window.location.href = '/admin/servers';
    }
    if (e.ctrlKey && e.key === 'u') {
      // Ctrl+U for users
      window.location.href = '/admin/users';
    }
  });
}
</script>"

# Apply to admin layout
if [ -f "$ADMIN_LAYOUT" ]; then
  sed -i "/<\/head>/i $ADMIN_ENHANCEMENTS" "$ADMIN_LAYOUT"
  echo "âœ… Admin layout enhanced with premium features"
fi

# ===== 3. UPDATE AUTH LAYOUT (LOGIN PAGE) =====
AUTH_CSS="<style>
/* Premium Login Page */
body:not(.in-file-manager) #app > div {
  background: 
    radial-gradient(ellipse at 30% 30%, rgba(10, 132, 255, 0.15) 0%, transparent 50%),
    radial-gradient(ellipse at 70% 70%, rgba(191, 90, 242, 0.15) 0%, transparent 50%),
    linear-gradient(135deg, rgba(0,0,0,0.95) 0%, rgba(20,20,30,0.9) 100%),
    url('${BG_IMAGE}') !important;
  background-size: cover !important;
  background-position: center !important;
  background-attachment: fixed !important;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
}

/* Animated particles */
body:not(.in-file-manager) #app > div::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: 
    radial-gradient(circle at 20% 30%, rgba(10, 132, 255, 0.1) 0%, transparent 40%),
    radial-gradient(circle at 80% 40%, rgba(191, 90, 242, 0.1) 0%, transparent 40%),
    radial-gradient(circle at 40% 70%, rgba(48, 209, 88, 0.05) 0%, transparent 40%);
  animation: particleFloat 20s ease-in-out infinite;
  pointer-events: none;
}

@keyframes particleFloat {
  0%, 100% { transform: translate(0, 0); }
  50% { transform: translate(10px, -10px); }
}

/* Login Card */
body:not(.in-file-manager) .bg-white,
body:not(.in-file-manager) .bg-gray-100 {
  background: rgba(28, 28, 30, 0.95) !important;
  backdrop-filter: blur(50px) saturate(200%) !important;
  -webkit-backdrop-filter: blur(50px) saturate(200%) !important;
  border: 1px solid rgba(56, 56, 58, 0.6) !important;
  border-radius: 28px !important;
  padding: 3rem !important;
  max-width: 440px !important;
  width: 90% !important;
  margin: 2rem !important;
  box-shadow: 
    0 30px 80px rgba(0,0,0,0.6),
    0 0 100px rgba(10, 132, 255, 0.15),
    inset 0 1px 0 rgba(255,255,255,0.1) !important;
  position: relative;
  z-index: 1;
}

/* Login Title Animation */
body:not(.in-file-manager) .text-2xl,
body:not(.in-file-manager) .text-3xl {
  background: linear-gradient(90deg, #0a84ff, #5ac8fa, #bf5af2, #5ac8fa, #0a84ff) !important;
  -webkit-background-clip: text !important;
  -webkit-text-fill-color: transparent !important;
  background-size: 300% auto !important;
  animation: gradientFlow 4s ease infinite !important;
  font-weight: 900 !important;
  letter-spacing: -0.5px !important;
  text-align: center !important;
  margin-bottom: 2.5rem !important;
  font-size: 2.5rem !important;
}

@keyframes gradientFlow {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* Login Button Premium */
body:not(.in-file-manager) button[type=\"submit\"] {
  width: 100% !important;
  margin-top: 2rem !important;
  font-size: 18px !important;
  padding: 20px !important;
  border-radius: 16px !important;
  background: linear-gradient(135deg, #0a84ff, #007aff, #0056d6) !important;
  position: relative;
  overflow: hidden;
}

body:not(.in-file-manager) button[type=\"submit\"]::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
  transition: left 0.7s;
}

body:not(.in-file-manager) button[type=\"submit\"]:hover::before {
  left: 100%;
}

/* Copyright */
body:not(.in-file-manager) .text-center.text-xs.text-gray-500::after {
  content: 'Â© 2024 Rendzz Official â€¢ Premium iOS Theme v2.0';
  color: rgba(142, 142, 147, 0.8) !important;
  font-size: 12px !important;
  margin-top: 2.5rem !important;
  display: block;
  letter-spacing: 0.5px;
}
</style>"

sed -i "/<\/head>/i $AUTH_CSS" "$AUTH_LAYOUT"
echo "âœ… Auth layout updated with premium login design"

# ===== 4. ADD FONTS =====
FONT_LINK='<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=SF+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">'

sed -i "/<\/head>/i $FONT_LINK" "$AUTH_LAYOUT"
sed -i "/<\/head>/i $FONT_LINK" "$APP_LAYOUT"
sed -i "/<\/head>/i $FONT_LINK" "$ADMIN_LAYOUT"
echo "âœ… Premium fonts added"

# ===== 5. PERMISSIONS =====
chown -R www-data:www-data "$PANEL_PATH"

# ===== 6. CLEAR CACHE =====
cd "$PANEL_PATH" || exit
php artisan view:clear
php artisan cache:clear
php artisan config:clear
php artisan route:clear

echo "========================================="
echo "ðŸš€ PREMIUM iOS THEME UPDATED SUCCESSFULLY!"
echo "========================================="
echo "ðŸ’Ž PREMIUM FEATURES INCLUDED:"
echo "â€¢ Dynamic Animated Backgrounds"
echo "â€¢ Premium Console with Terminal UI"
echo "â€¢ Animated Stats Cards with Progress Bars"
echo "â€¢ Admin Panel with Crown Badge"
echo "â€¢ Live Data Animations"
echo "â€¢ Gradient Text Effects"
echo "â€¢ Enhanced Server Statistics"
echo "â€¢ Quick Action Shortcuts"
echo "â€¢ File Manager 100% Original"
echo "â€¢ RENSTR Branding Throughout"
echo "========================================="
echo "ðŸŽ® Console Features:"
echo "  âœ“ Terminal-style interface"
echo "  âœ“ Live status indicators"
echo "  âœ“ Animated progress bars"
echo "  âœ“ Real-time data updates"
echo "  âœ“ Custom RENSTR branding"
echo "========================================="
echo "ðŸ‘‘ Admin Features:"
echo "  âœ“ Administrator badge"
echo "  âœ“ Quick stats dashboard"
echo "  âœ“ Enhanced navigation"
echo "  âœ“ Keyboard shortcuts"
echo "  âœ“ Status indicators"
echo "========================================="
echo "ðŸ”„ Please refresh your browser!"
echo "========================================="
